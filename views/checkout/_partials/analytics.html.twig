{# Google Analytics actions when order placed #}
{% if app.params.seo.google_analytics is not empty and app.params.seo.google_tag_manager is empty %}
    {% if final_order is defined %}
        <!-- Google Analytics Transaction-->
        <script>
            ga('require', 'ecommerce', 'ecommerce.js');   // Load the ecommerce plug-in.
            ga('ecommerce:addTransaction', {
                    'id': '{{final_order.order_number}}',                     // Transaction ID. Required
                    'affiliation': '{{app.params.site.title}}',   // Affiliation or store name
                    'revenue': '{{final_order.total}}',               // Grand Total
                    'shipping': '{{final_order.shipping_rate}}',                  // Shipping
                    'tax': '{{final_order.tax}}'                     // Tax
                    });
            {% for item in items %}
                ga('ecommerce:addItem', {
                    'id': '{{final_order.order_number}}',                     // Transaction ID. Required
                    'name': '{{ item.name }}',                // Product name. Required
                    'sku': '{{ products[item.product_id].0.sku }}',                    // SKU/code
                    //'category': 'Green Medium',       // Category or variation
                    'price': '{{ item.price }}',                 // Unit price
                    'quantity': '{{ item.quantity }}'                   // Quantity
                    });
            {% endfor %}
            ga('ecommerce:send');      // Send transaction and item data to Google Analytics.
        </script>
        <!-- Google Analytics Transaction End -->
    {% endif %}
{% endif %}